<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>AI Terms Flashcard Game - 2 Players</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            height: 100%;
            min-height: 100%;
            position: fixed;
            width: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) fixed;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) fixed;
            width: 100%;
            height: 100%;
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }
        
        h1 {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            color: #4a5568;
            text-align: center;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .player-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .player-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }
        
        .player-button.player-a {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }
        
        .player-button.player-a:hover {
            box-shadow: 0 10px 20px rgba(66, 153, 225, 0.4);
        }
        
        .player-button.player-b {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .player-button.player-b:hover {
            box-shadow: 0 10px 20px rgba(72, 187, 120, 0.4);
        }
        
        .player-button:hover {
            transform: translateY(-2px);
        }
        
        .player-button:focus {
            outline: 3px solid #667eea;
            outline-offset: 3px;
        }
        
        .player-button:active {
            transform: translateY(0);
        }
        
        .game-area {
            display: none;
        }
        
        .game-area.active {
            display: block;
            padding-top: 80px; /* Add space for sticky progress bar */
        }
        
        .progress-section {
            position: sticky;
            top: -80px;
            z-index: 10;
            background: white;
            margin: -80px -40px 20px -40px;
            padding: 15px 40px 15px 40px;
        }
        
        .progress-section.has-shadow {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .card-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #4a5568;
        }
        
        .current-player {
            font-weight: 600;
            color: #667eea;
        }
        
        .flashcard {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 2px solid #cbd5e0;
            border-radius: 12px;
            padding: 40px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .role-label {
            color: #667eea;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }
        
        .term {
            color: #1a202c;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.3;
        }
        
        .definition {
            color: #2d3748;
            font-size: 18px;
            line-height: 1.6;
        }
        
        .instructions {
            background: #fff5e6;
            border-left: 4px solid #f6ad55;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: #744210;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .instructions-collapsible {
            margin-bottom: 20px;
        }
        
        .instructions-toggle {
            background: #fff5e6;
            border: 2px solid #f6ad55;
            border-radius: 8px;
            padding: 12px 16px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #744210;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .instructions-toggle:hover {
            background: #ffecd1;
        }
        
        .instructions-toggle-icon {
            transition: transform 0.3s;
            font-size: 18px;
        }
        
        .instructions-toggle-icon.open {
            transform: rotate(180deg);
        }
        
        .instructions-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .instructions-content.open {
            max-height: 500px;
        }
        
        .instructions-content-inner {
            padding: 15px 16px;
            background: #fff5e6;
            border: 2px solid #f6ad55;
            border-top: none;
            border-radius: 0 0 8px 8px;
            color: #744210;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        }
        
        .btn:focus {
            outline: 3px solid #667eea;
            outline-offset: 3px;
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .btn-danger {
            background: #fc8181;
            color: white;
        }
        
        .btn-danger:hover {
            background: #f56565;
            box-shadow: 0 8px 16px rgba(245, 101, 101, 0.4);
        }
        
        .completion-screen {
            text-align: center;
            display: none;
        }
        
        .completion-screen.active {
            display: block;
        }
        
        .completion-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .completion-title {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .completion-message {
            color: #4a5568;
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }
            
            .container {
                padding: 20px;
                margin: 10px 0;
            }
            
            .game-area.active {
                padding-top: 60px;
            }
            
            .progress-section {
                margin: -60px -20px 15px -20px;
                padding: 12px 20px 12px 20px;
                border-radius: 16px 16px 0 0;
                top: -60px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            .player-selection {
                flex-direction: column;
                gap: 12px;
            }
            
            .player-button {
                padding: 15px 30px;
                font-size: 18px;
                width: 100%;
            }
            
            .card-info {
                font-size: 12px;
                flex-wrap: wrap;
                gap: 8px;
                justify-content: space-between;
            }
            
            #set-number-display {
                flex-basis: 100%;
                text-align: center;
            }
            
            .term {
                font-size: 22px;
            }
            
            .definition {
                font-size: 16px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                flex: 1 1 auto;
                min-width: 0;
            }
            
            .controls {
                gap: 8px;
            }
            
            .flashcard {
                padding: 25px 20px;
                min-height: 200px;
                margin-bottom: 15px;
            }
            
            .instructions {
                padding: 12px 16px;
                font-size: 14px;
                margin-bottom: 15px;
            }
            
            .instructions-toggle {
                padding: 10px 14px;
                font-size: 14px;
            }
            
            .instructions-content-inner {
                padding: 12px 14px;
                font-size: 14px;
            }
            
            .completion-icon {
                font-size: 60px;
            }
            
            .completion-title {
                font-size: 24px;
            }
            
            .completion-message {
                font-size: 16px;
            }
            
            #set-number-input {
                font-size: 16px !important;
                padding: 10px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Terms Flashcard Game</h1>
        <p class="subtitle">A cooperative learning game for two players</p>
        
        <!-- Screen reader announcements -->
        <div id="announcements" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>
        
        <!-- Player Selection Screen -->
        <div id="player-selection" class="player-selection-screen">
            <div class="instructions">
                <strong>Welcome!</strong> One player should choose "Player A" and the other should choose "Player B". You'll take turns explaining terms to each other.
            </div>
            <div class="player-selection">
                <button class="player-button player-a" onclick="selectPlayer('A')" tabindex="0">
                    I'm Player A
                </button>
                <button class="player-button player-b" onclick="selectPlayer('B')" tabindex="0">
                    I'm Player B
                </button>
            </div>
        </div>
        
        <!-- Set Selection Screen -->
        <div id="set-selection" class="set-selection-screen" style="display: none;" role="region" aria-labelledby="set-selection-heading">
            <h2 id="set-selection-heading" class="sr-only">Game Set Selection</h2>
            <div id="set-message" class="instructions" aria-live="polite"></div>
            <div id="set-input-container" style="display: none; margin-bottom: 20px;">
                <label for="set-number-input" style="display: block; margin-bottom: 10px; font-weight: 600; color: #2d3748;">
                    Enter the set number (1-10):
                </label>
                <input 
                    type="number" 
                    id="set-number-input" 
                    min="1" 
                    max="10" 
                    style="width: 100%; padding: 12px; font-size: 18px; border: 2px solid #cbd5e0; border-radius: 8px; text-align: center;"
                    placeholder="Enter number"
                    aria-describedby="set-error"
                />
                <div id="set-error" style="color: #e53e3e; margin-top: 10px; display: none; font-weight: 600;" role="alert" aria-live="assertive"></div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-secondary" onclick="backToPlayerSelection()" tabindex="0">
                    Back
                </button>
                <button class="btn" id="continue-btn" onclick="continueToGame()" tabindex="0">
                    Continue
                </button>
            </div>
        </div>
        
        <!-- Game Area -->
        <div id="game-area" class="game-area">
            <div class="progress-section" id="progress-section">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                
                <div class="card-info">
                    <span class="current-player">Current: <span id="current-player-name"></span></span>
                    <span id="card-counter">Card 1 of 18</span>
                    <span id="set-number-display" style="color: #667eea; font-weight: 600;"></span>
                </div>
            </div>
            
            <div class="instructions-collapsible">
                <button class="instructions-toggle" onclick="toggleInstructions()" id="instructions-toggle">
                    <span id="instructions-toggle-text">Show Instructions</span>
                    <span class="instructions-toggle-icon" id="instructions-toggle-icon">â–¼</span>
                </button>
                <div class="instructions-content" id="instructions-content">
                    <div class="instructions-content-inner" id="instructions-text"></div>
                </div>
            </div>
            
            <div class="flashcard">
                <div class="role-label" id="role-label"></div>
                <div id="card-content"></div>
            </div>
            
            <div class="controls">
                <button class="btn btn-danger" onclick="resetGame()" tabindex="0">
                    Start Over
                </button>
                <button class="btn btn-secondary" id="prev-btn" onclick="previousCard()" tabindex="0" disabled>
                    Previous
                </button>
                <button class="btn" id="next-btn" onclick="nextCard()" tabindex="0">
                    Next Card
                </button>
            </div>
        </div>
        
        <!-- Completion Screen -->
        <div id="completion-screen" class="completion-screen">
            <div class="completion-icon">ðŸŽ‰</div>
            <h2 class="completion-title">Congratulations!</h2>
            <p class="completion-message">
                You've completed all 18 AI terms together!<br>
                Great teamwork!
            </p>
            <button class="btn" onclick="resetGame()" tabindex="0">
                Play Again
            </button>
        </div>
    </div>
    
    <script>
        // Base cards that always come first
        const baseCards = [
            {
                term: "LLM (Large-language model)",
                definition: "An LLM is a Large-Language Model, a type of Generative AI that has been trained on lots of examples of text so that it can identify statistical patterns between words and ideas and consequently generate new text based on these patterns."
            },
            {
                term: "Prompt",
                definition: "An instruction you give to an LLM. There are certain 'prompting techniques' that have been found to help LLMs perform well, such as giving examples."
            }
        ];
        
        // All other cards to be shuffled into different sets
        const allOtherCards = [
            {
                term: "Hallucinate",
                definition: "When an LLM confidently states something plausible but completely fabricated. Occurs because models create statistically probable content rather than necessarily 'correct' content. Not all AI mistakes are hallucinations; some mistakes are based on incorrect data."
            },
            {
                term: "Token",
                definition: "How LLMs process text â€“ not necessarily full words, but parts of words or punctuation. 'Unbreakable' = three tokens: 'un', 'break', 'able'. OpenAI estimates 1 token â‰ˆ 0.75 words. Important because context windows (how much info an LLM can 'remember') are specified in tokens."
            },
            {
                term: "Context window",
                definition: "How much information an LLM can hold in 'working memory' at once. For LSE Claude users: 500,000 tokens (around 400,000 words). Performance may decrease in very long conversations."
            },
            {
                term: "Knowledge cut-off point",
                definition: "The date after which an AI model has no built-in knowledge of world events, based on when training data was collected. Claude's newest models: January 2025. Models need web search for information after this date. To reliably get up-to-date info, explicitly tell the LLM to use web search."
            },
            {
                term: "Claude Artifact",
                definition: "Content created by Claude and shown in a separate panel or shared as a standalone link. Can be documents, visualisations, or interactive web-apps. Shareable with anyone who has LSE Claude account access. ChatGPT and Google Gemini have similar features called 'Canvas'."
            },
            {
                term: "Role and goal (prompting technique)",
                definition: "Giving an LLM a specific role (e.g., 'patient tutor') and goal (e.g., 'help students construct knowledge'). One of the best ways to control chatbot behaviour."
            },
            {
                term: "Constraints (prompting technique)",
                definition: "Instructions specifying what the LLM must do or avoid. Positive constraints ('do this') work more reliably than negative ones ('don't do this')."
            },
            {
                term: "Chain-of-thought prompting",
                definition: "Breaking down a complex task into logical steps in your instructions: for an LLM: 'First, do X. Then, do Y. Finally, do Z.' Helps the model process tasks systematically."
            },
            {
                term: "AI sycophancy",
                definition: "The tendency of an LLM to agree with a user's perspective rather than offering neutral or critical viewpoints. Counter this by explicitly instructing the LLM to provide critical feedback or varied perspectives."
            },
            {
                term: "System Prompt",
                definition: "Instructions that control an LLM's behaviour in every chat. Many companies keep these secret, but Anthropic makes Claude's system prompts publicly available on their website. Useful for understanding LLM behaviour and improving your own prompts."
            },
            {
                term: "Claude Project",
                definition: "Claude Projects are essential custom versions of Claude you can set up with your own instructions and access to documents you upload. Similar to OpenAI's Custom GPTs, Microsoft Copilot Agents, Google Gemini Gems."
            },
            {
                term: "Copilot Agent",
                definition: "Microsoft's feature for creating chatbots with custom instructions. Similar to OpenAI's Custom GPTs. Premium licenses allow access to files in SharePoint and tools like Python. Typically shareable only within the same institution."
            },
            {
                term: "'Reasoning' model",
                definition: "Newer LLM versions that have been trained to automatically do things like create plans, ask clarifying questions and work step-by-step. Most models activate 'reasoning' based on query complexity. In Claude you can turn on 'Extended thinking' mode for more complicated tasks."
            },
            {
                term: "Agent / Agentic",
                definition: "An AI model or series of models that can use tools (like coding tools or web browsers) and act autonomously toward a goal. Note: 'Copilot Agent' is a slightly misleading name for a feature in Copilot that is more of a custom chatbot that a real 'Agent'. Copilot Agents are similar to Claude Projects or OpenAI's Custom GPTs."
            },
            {
                term: "Prompt injection",
                definition: "Prompt injection is a security exploit where an attacker hides malicious instructions for an LLM within a piece of content (e.g., a webpage or email). When the LLM processes that content, it is exposed to the hidden instructions."
            },
            {
                term: "Grounding",
                definition: "Grounding refers to asking a chatbot to only answer using information in specific sources, such as documents you've uploaded to a Claude project. This is a good way to reduce 'hallucinations', which can occur when it creates answers purely based on statistical patterns from its training data."
            }
        ];
        
        // Fisher-Yates shuffle with seed
        function seededShuffle(array, seed) {
            const shuffled = [...array];
            let currentSeed = seed;
            
            // Simple seeded random number generator
            function seededRandom() {
                currentSeed = (currentSeed * 9301 + 49297) % 233280;
                return currentSeed / 233280;
            }
            
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // Generate 10 pre-set randomized orders
        const cardSets = {};
        for (let i = 1; i <= 10; i++) {
            cardSets[i] = [...baseCards, ...seededShuffle(allOtherCards, i * 1000)];
        }
        
        let flashcards = [];
        let selectedSet = null;
        
        let currentPlayer = '';
        let currentCardIndex = 0;
        let playerARole = 'explainer'; // 'explainer' or 'listener'
        let instructionsOpen = false;
        let pendingPlayer = null;
        
        function announce(message) {
            const announcementDiv = document.getElementById('announcements');
            announcementDiv.textContent = message;
        }
        
        function selectPlayer(player) {
            pendingPlayer = player;
            
            // Hide player selection screen
            document.getElementById('player-selection').style.display = 'none';
            
            // Show set selection screen
            const setSelectionScreen = document.getElementById('set-selection');
            const setMessage = document.getElementById('set-message');
            const setInputContainer = document.getElementById('set-input-container');
            
            setSelectionScreen.style.display = 'block';
            
            if (player === 'A') {
                // Player A: randomly select and show set number
                selectedSet = Math.floor(Math.random() * 10) + 1;
                flashcards = cardSets[selectedSet];
                
                setMessage.innerHTML = `<strong>Player A:</strong> Your game set number is <strong style="font-size: 24px; color: #667eea;">${selectedSet}</strong><br><br>Tell Player B to enter this number when they start.`;
                setInputContainer.style.display = 'none';
                
                announce(`You are Player A. Your set number is ${selectedSet}.`);
            } else {
                // Player B: show input for set number
                setMessage.innerHTML = `<strong>Player B:</strong> Enter the set number that Player A told you.`;
                setInputContainer.style.display = 'block';
                document.getElementById('set-error').style.display = 'none';
                
                announce('You are Player B. Please enter the set number.');
                
                // Focus on input
                setTimeout(() => {
                    document.getElementById('set-number-input').focus();
                }, 100);
            }
        }
        
        function backToPlayerSelection() {
            document.getElementById('set-selection').style.display = 'none';
            document.getElementById('player-selection').style.display = 'block';
            document.getElementById('set-number-input').value = '';
            document.getElementById('set-error').style.display = 'none';
            pendingPlayer = null;
            selectedSet = null;
        }
        
        function continueToGame() {
            if (pendingPlayer === 'B') {
                // Validate Player B's input
                const input = document.getElementById('set-number-input').value;
                const setNum = parseInt(input);
                const errorDiv = document.getElementById('set-error');
                
                if (!input || isNaN(setNum) || setNum < 1 || setNum > 10) {
                    errorDiv.textContent = 'Please enter a valid number between 1 and 10.';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                selectedSet = setNum;
                flashcards = cardSets[selectedSet];
            }
            
            // Start the game
            startGame(pendingPlayer);
        }
        
        function startGame(player) {
            currentPlayer = player;
            currentCardIndex = 0;
            playerARole = 'explainer';
            instructionsOpen = false;
            
            document.getElementById('set-selection').style.display = 'none';
            document.getElementById('game-area').classList.add('active');
            
            // Display the set number
            document.getElementById('set-number-display').textContent = `Set: ${selectedSet}`;
            
            announce(`Game started. You are Player ${player}. Using set ${selectedSet}. Loading first card.`);
            displayCard();
        }
        
        function toggleInstructions() {
            instructionsOpen = !instructionsOpen;
            const content = document.getElementById('instructions-content');
            const icon = document.getElementById('instructions-toggle-icon');
            const toggleText = document.getElementById('instructions-toggle-text');
            
            if (instructionsOpen) {
                content.classList.add('open');
                icon.classList.add('open');
                toggleText.textContent = 'Hide Instructions';
            } else {
                content.classList.remove('open');
                icon.classList.remove('open');
                toggleText.textContent = 'Show Instructions';
            }
        }
        
        function displayCard() {
            const card = flashcards[currentCardIndex];
            const isExplainer = (currentPlayer === 'A' && playerARole === 'explainer') || 
                               (currentPlayer === 'B' && playerARole === 'listener');
            
            // Update progress
            const progress = ((currentCardIndex + 1) / flashcards.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('card-counter').textContent = `Card ${currentCardIndex + 1} of ${flashcards.length}`;
            
            // Update player name
            document.getElementById('current-player-name').textContent = `Player ${currentPlayer}`;
            
            // Update button states
            const prevBtn = document.getElementById('prev-btn');
            prevBtn.disabled = currentCardIndex === 0;
            
            // Set role and content
            const roleLabel = document.getElementById('role-label');
            const cardContent = document.getElementById('card-content');
            const instructionsText = document.getElementById('instructions-text');
            
            if (isExplainer) {
                roleLabel.textContent = 'Your Term (Explain This)';
                cardContent.innerHTML = `<div class="term">${card.term}</div>`;
                instructionsText.innerHTML = `<strong>Your role:</strong> Try to explain the term "<strong>${card.term}</strong>" to your partner. If you're not sure, you can ask your partner for help.`;
                announce(`Your turn to explain. The term is: ${card.term}`);
            } else {
                roleLabel.textContent = 'The Definition (Listen & Help)';
                cardContent.innerHTML = `
                    <div class="term" style="font-size: 22px; margin-bottom: 15px; color: #4a5568;">${card.term}</div>
                    <div class="definition">${card.definition}</div>
                `;
                instructionsText.innerHTML = `<strong>Your role:</strong> Listen to your partner explain "<strong>${card.term}</strong>". If they need help, provide hints or read the correct definition to them.`;
                announce(`Your turn to listen and help. The term is: ${card.term}. You have the definition.`);
            }
            
            // Reset instructions to closed state for new card
            const content = document.getElementById('instructions-content');
            const icon = document.getElementById('instructions-toggle-icon');
            const toggleText = document.getElementById('instructions-toggle-text');
            content.classList.remove('open');
            icon.classList.remove('open');
            toggleText.textContent = 'Show Instructions';
            instructionsOpen = false;
        }
        
        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                // Swap roles back
                playerARole = playerARole === 'explainer' ? 'listener' : 'explainer';
                displayCard();
            }
        }
        
        function nextCard() {
            currentCardIndex++;
            
            if (currentCardIndex >= flashcards.length) {
                showCompletion();
                return;
            }
            
            // Swap roles
            playerARole = playerARole === 'explainer' ? 'listener' : 'explainer';
            
            displayCard();
        }
        
        function showCompletion() {
            document.getElementById('game-area').classList.remove('active');
            document.getElementById('completion-screen').classList.add('active');
            announce('Game completed! You have finished all cards. Congratulations!');
        }
        
        function resetGame() {
            currentCardIndex = 0;
            playerARole = 'explainer';
            instructionsOpen = false;
            selectedSet = null;
            flashcards = [];
            pendingPlayer = null;
            
            document.getElementById('completion-screen').classList.remove('active');
            document.getElementById('game-area').classList.remove('active');
            document.getElementById('set-selection').style.display = 'none';
            document.getElementById('player-selection').style.display = 'block';
            document.getElementById('set-number-input').value = '';
            document.getElementById('set-error').style.display = 'none';
            
            announce('Game reset. Please select your player.');
        }
        
        // Add shadow to progress bar when scrolling
        let lastScrollTop = 0;
        const container = document.querySelector('.container');
        const progressSection = document.getElementById('progress-section');
        
        container.addEventListener('scroll', function() {
            const scrollTop = container.scrollTop;
            
            if (scrollTop > 10) {
                progressSection.classList.add('has-shadow');
            } else {
                progressSection.classList.remove('has-shadow');
            }
            
            lastScrollTop = scrollTop;
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                const activeElement = document.activeElement;
                if (activeElement.tagName === 'BUTTON') {
                    e.preventDefault();
                    activeElement.click();
                } else if (activeElement.id === 'set-number-input' && e.key === 'Enter') {
                    e.preventDefault();
                    continueToGame();
                }
            }
        });
    </script>
</body>
</html>